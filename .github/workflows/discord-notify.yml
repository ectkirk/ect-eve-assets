name: Discord Notification

on:
  push:
    branches:
      - main
      - develop

permissions: {}

jobs:
  notify:
    runs-on: windows-latest
    steps:
      - name: Post to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        shell: pwsh
        run: |
          $commitMsg = "${{ github.event.head_commit.message }}".Split("`n")[0]
          $body = @{
            embeds = @(@{
              title = "New commit to ${{ github.ref_name }}"
              description = "**$commitMsg**"
              url = "${{ github.event.head_commit.url }}"
              color = 5814783
              fields = @(
                @{ name = "Author"; value = "${{ github.event.head_commit.author.name }}"; inline = $true }
                @{ name = "Repository"; value = "${{ github.repository }}"; inline = $true }
              )
            })
          } | ConvertTo-Json -Depth 4
          Invoke-RestMethod -Uri $env:DISCORD_WEBHOOK -Method Post -ContentType "application/json" -Body $body
